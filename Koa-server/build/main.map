{"version":3,"sources":["webpack:///webpack/bootstrap ab11ea891d9c17ff411f","webpack:///./src/index.js","webpack:///./node_modules/babel-runtime/regenerator/index.js","webpack:///external \"regenerator-runtime\"","webpack:///external \"koa\"","webpack:///external \"http\"","webpack:///external \"ws\"","webpack:///external \"koa-router\"","webpack:///external \"koa-cors\"","webpack:///external \"koa-bodyparser\""],"names":["Koa","require","app","server","createServer","callback","WebSocket","wss","Server","Router","cors","bodyparser","use","ctx","next","start","Date","ms","console","log","method","url","response","status","body","issue","error","message","Tag","id","name","version","tags","push","lastUpdated","now","lastId","pageSize","broadcast","clients","forEach","client","readyState","OPEN","send","JSON","stringify","data","router","get","ifModifiedSince","request","getTime","getMilliseconds","text","query","page","set","toUTCString","offset","slice","more","length","createTag","tag","parseInt","event","post","routes","allowedMethods","listen"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap ab11ea891d9c17ff411f","const Koa = require('koa');\r\nconst app = new Koa();\r\nconst server = require('http').createServer(app.callback());\r\nconst WebSocket = require('ws');\r\nconst wss = new WebSocket.Server({server});\r\nconst Router = require('koa-router');\r\nconst cors = require('koa-cors');\r\nconst bodyparser = require('koa-bodyparser');\r\n\r\napp.use(bodyparser());\r\n\r\napp.use(cors());\r\n\r\napp.use(async (ctx, next) => { // logger\r\n  const start = new Date();\r\n  await next();\r\n  const ms = new Date() - start;\r\n  console.log(`${ctx.method} ${ctx.url} ${ctx.response.status} - ${ms}ms`);\r\n});\r\n\r\napp.use(async (ctx, next) => { // error handler\r\n  try {\r\n    await next();\r\n  } catch (err) {\r\n    ctx.response.body = { issue: [{ error: err.message || 'Unexpected error' }] };\r\n    ctx.response.status = 500; // internal server error\r\n  }\r\n});\r\n\r\nclass Tag {\r\n    constructor({id, name, version}){\r\n        this.id = id;\r\n        this.name = name;\r\n        this.version = version;\r\n    }\r\n}\r\n\r\nconst tags = [];\r\ntags.push(new Tag({id: 1, name:'food', version: 1}));\r\ntags.push(new Tag({id: 2, name:'bills', version: 1}));\r\ntags.push(new Tag({id: 3, name:'entertainment', version: 1}));\r\n\r\nlet lastUpdated = new Date(Date.now());\r\nlet lastId = 3;\r\nconst pageSize = 10;\r\n\r\nconst broadcast = data =>\r\n  wss.clients.forEach(client => {\r\n    if (client.readyState === WebSocket.OPEN) {\r\n      client.send(JSON.stringify(data));\r\n    }\r\n  });\r\n\r\nconst router = new Router();\r\nrouter.get('/tag', ctx => {\r\n  const ifModifiedSince = ctx.request.get('If-Modified-Since');\r\n  if (ifModifiedSince && new Date(ifModifiedSince).getTime() >= lastUpdated.getTime() - lastUpdated.getMilliseconds()) {\r\n    ctx.response.status = 304; // NOT MODIFIED\r\n    return;\r\n  }\r\n  const text = ctx.request.query.text;\r\n  const page = ctx.request.query.page || 1;\r\n  ctx.response.set('Last-Modified', lastUpdated.toUTCString());\r\n  const offset = (page - 1) * pageSize;\r\n  ctx.response.body = {\r\n    page,\r\n    tags: tags.slice(offset, offset + pageSize),\r\n    more: offset + pageSize < tags.length\r\n  };\r\n  ctx.response.status = 200; // OK\r\n});\r\n\r\nconst createTag = async (ctx) => {\r\n  const tag = ctx.request.body;\r\n  if (!tag.name) { // validation\r\n    ctx.response.body = { issue: [{ error: 'Name is missing' }] };\r\n    ctx.response.status = 400; //  BAD REQUEST\r\n    return;\r\n  }\r\n  tag.id = `${parseInt(lastId) + 1}`;\r\n  lastId = tag.id;\r\n  tag.version = 1;\r\n  tags.push(tag);\r\n  ctx.response.body = tag;\r\n  ctx.response.status = 201; // CREATED\r\n  broadcast({ event: 'created', tag });\r\n};\r\n\r\nrouter.post('/tag', async (ctx) => {\r\n  await createTag(ctx);\r\n});\r\n\r\n\r\napp.use(router.routes());\r\napp.use(router.allowedMethods());\r\n\r\nserver.listen(3000);\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","module.exports = require(\"regenerator-runtime\");\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/babel-runtime/regenerator/index.js\n// module id = 2\n// module chunks = 0","module.exports = require(\"regenerator-runtime\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"regenerator-runtime\"\n// module id = 3\n// module chunks = 0","module.exports = require(\"koa\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa\"\n// module id = 4\n// module chunks = 0","module.exports = require(\"http\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"http\"\n// module id = 5\n// module chunks = 0","module.exports = require(\"ws\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"ws\"\n// module id = 6\n// module chunks = 0","module.exports = require(\"koa-router\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-router\"\n// module id = 7\n// module chunks = 0","module.exports = require(\"koa-cors\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-cors\"\n// module id = 8\n// module chunks = 0","module.exports = require(\"koa-bodyparser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-bodyparser\"\n// module id = 9\n// module chunks = 0"],"sourceRoot":""}